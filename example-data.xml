<?xml version="1.0" encoding="UTF-8"?>
<nc:data
    xmlns:nc="urn:ietf:params:xml:ns:netconf:base:1.0"
    xmlns="http://www.nic.cz/ns/yang/dns-server"
    xmlns:dnss="http://www.nic.cz/ns/yang/dns-server"
    xmlns:tsig="http://www.nic.cz/ns/yang/tsig-algorithms"
    xmlns:dnssec="http://www.nic.cz/ns/yang/dnssec-signing"
    xmlns:knot="http://www.nic.cz/ns/yang/knot-dns">
  <dns-server>
    <description>Example DNS server configuration.</description>
    <server-options>
      <description>Server options.</description>
      <knot:async-start>true</knot:async-start>
      <chaos-identity>
	<id-server>I have no mouth and must scream.</id-server>
	<version>2.0</version>
      </chaos-identity>
      <nsid-identity>
	<nsid>myserver0.example.com</nsid>
      </nsid-identity>
      <listen-endpoint>
	<name>01</name>
	<ip-address>127.0.0.1</ip-address>
	<port>53531</port>
      </listen-endpoint>
      <listen-endpoint>
	<name>02</name>
	<ip-address>::1</ip-address>
      </listen-endpoint>
      <filesystem-paths>
	<run-time-dir>/tmp/knot</run-time-dir>
	<pid-file>knot.pid</pid-file>
      </filesystem-paths>
      <privileges>
	<user>knot</user>
	<group>wheel</group>
      </privileges>
      <resources>
	<knot:tcp-workers>3</knot:tcp-workers>
	<knot:udp-workers>42</knot:udp-workers>
      </resources>
      <response-rate-limiting>
	<table-size>1000000</table-size>
      </response-rate-limiting>
    </server-options>
    <knot:log>
      <knot:target>syslog</knot:target>
      <knot:any>warning</knot:any>
    </knot:log>
    <knot:log>
      <knot:target>/tmp/knot.log</knot:target>
      <knot:server>info</knot:server>
      <knot:zone>info</knot:zone>
    </knot:log>
    <access-control-list>
      <name>acl-xfr-update</name>
      <network>
        <name>01</name>
        <ip-prefix>127.0.0.1/32</ip-prefix>
      </network>
      <key>key0.server0</key>
      <operation>transfer</operation>
      <operation>update</operation>
    </access-control-list>
    <access-control-list>
      <name>acl-notify</name>
      <network>
        <name>01</name>
        <ip-prefix>::1/128</ip-prefix>
      </network>
      <network>
        <name>02</name>
        <ip-prefix>2001:db8::/64</ip-prefix>
      </network>
      <operation>notify</operation>
      <action>deny</action>
    </access-control-list>
    <access-control-list>
      <name>socket</name>
      <network>
	<name>01</name>
	<ip-prefix>192.0.2.0/28</ip-prefix>
      </network>
      <operation>control</operation>
    </access-control-list>
    <key>
      <name>key0.server0</name>
      <algorithm>tsig:hmac-sha256</algorithm>
      <secret>Wg==</secret>
    </key>
    <key>
      <name>key0.example.com</name>
      <description>slave key</description>
      <secret>Wg==</secret>
    </key>
    <remote-server>
      <name>server0</name>
      <remote>
	<ip-address>127.0.0.1</ip-address>
	<port>53531</port>
      </remote>
      <key>key0.server0</key>
      <local>
	<ip-address>127.0.0.1</ip-address>
	<port>6378</port>
      </local>
    </remote-server>
    <remote-server>
      <name>server1</name>
      <remote>
	<ip-address>2001:db8:0:1::1</ip-address>
      </remote>
      <key>key0.example.com</key>
    </remote-server>
    <knot:control-socket>
      <knot:ip-address>127.0.0.1</knot:ip-address>
      <knot:port>55553</knot:port>
      <knot:access-control-list>socket</knot:access-control-list>
    </knot:control-socket>
    <query-module>
      <type>knot:dnstap</type>
      <name>capture_all</name>
      <knot:dnstap>
	<knot:file>/tmp/capture.tap</knot:file>
      </knot:dnstap>
    </query-module>
    <query-module>
      <type>knot:dnsproxy</type>
      <name>default</name>
      <knot:dnsproxy>
	<knot:remote-server>
	  <knot:ip-address>10.0.1.1</knot:ip-address>
	</knot:remote-server>
      </knot:dnsproxy>
    </query-module>
    <query-module>
      <type>knot:rosedb</type>
      <name>default</name>
      <knot:rosedb>
	<knot:db-dir>/tmp/static_rrdb</knot:db-dir>
      </knot:rosedb>
    </query-module>
    <query-module>
      <type>knot:synth-record</type>
      <name>test1</name>
      <knot:synth-record>
	<knot:record-type>forward</knot:record-type>
	<knot:prefix>dynamic-</knot:prefix>
	<knot:ttl>400</knot:ttl>
	<knot:network>2620:0:b61::/52</knot:network>
      </knot:synth-record>
    </query-module>
    <query-module>
      <type>knot:synth-record</type>
      <name>test2</name>
      <knot:synth-record>
	<knot:record-type>reverse</knot:record-type>
	<knot:prefix>dynamic-</knot:prefix>
	<knot:origin>example</knot:origin>
	<knot:ttl>400</knot:ttl>
	<knot:network>2620:0:b61::/52</knot:network>
      </knot:synth-record>
    </query-module>
    <dnssec:sign-policy>
      <dnssec:name>default_rsa</dnssec:name>
      <dnssec:algorithm>RSASHA256</dnssec:algorithm>
      <dnssec:zsk-size>1024</dnssec:zsk-size>
      <dnssec:ksk-size>2048</dnssec:ksk-size>
    </dnssec:sign-policy>
    <zones>
      <template>
	<name>default</name>
	<description>Shared options for all zones.</description>
	<default>true</default>
	<zones-dir>/tmp/zones</zones-dir>
	<file>samples/%s.zone</file>
	<knot:semantic-checks>true</knot:semantic-checks>
	<any-to-tcp>true</any-to-tcp>
	<serial-update-method>unix-time</serial-update-method>
	<journal>
	  <from-differences>false</from-differences>
	  <zone-file-sync-delay>3600</zone-file-sync-delay>
	  <maximum-journal-size>1125899906842624</maximum-journal-size>
	</journal>
	<dnssec:dnssec-signing>
	  <dnssec:policy>default_rsa</dnssec:policy>
	  <knot:kasp-db>/var/lib/knot/kasp</knot:kasp-db>
	</dnssec:dnssec-signing>
	<query-module>
	  <type>knot:dnstap</type>
	  <name>capture_all</name>
	</query-module>
	<query-module>
	  <type>knot:dnsproxy</type>
	  <name>default</name>
	</query-module>
	<query-module>
	  <type>knot:rosedb</type>
	  <name>default</name>
	</query-module>
      </template>
      <zone>
	<domain>example.com</domain>
	<template>default</template>
	<master>server1</master>
	<notify>
	  <recipient>server0</recipient>
	</notify>
	<any-to-tcp>false</any-to-tcp>
	<access-control-list>acl-xfr-update</access-control-list>
	<access-control-list>acl-notify</access-control-list>
	<query-module>
	  <type>knot:synth-record</type>
	  <name>test1</name>
	</query-module>
	<query-module>
	  <type>knot:synth-record</type>
	  <name>test2</name>
	</query-module>
      </zone>
    </zones>
  </dns-server>
  <dns-server-state>
    <server>
      <boot-time>2015-05-21T08:02:14+02:00</boot-time>
      <config-time>2015-06-25T16:22:07+02:00</config-time>
    </server>
    <zone>
      <domain>example.com</domain>
      <class>IN</class>
      <serial>2015060600</serial>
      <server-role>slave</server-role>
      <dnssec:dnssec-signing>
	<dnssec:key>
	  <dnssec:key-id>d3a9fd3b36a6be275adea2b67c6e82b27ca30e90</dnssec:key-id>
	  <dnssec:key-tag>30348</dnssec:key-tag>
	  <dnssec:algorithm>RSASHA256</dnssec:algorithm>
	  <dnssec:size>2048</dnssec:size>
	  <dnssec:flags>zone-key secure-entry-point</dnssec:flags>
	  <dnssec:created>2015-06-18T18:02:45+02:00</dnssec:created>
	  <dnssec:publish>2015-06-18T19:00:00+02:00</dnssec:publish>
	  <dnssec:activate>2015-06-20T10:00:00+02:00</dnssec:activate>
	  <dnssec:retire>2015-07-18T18:02:45+02:00</dnssec:retire>
	  <dnssec:remove>2015-07-25T00:00:00+02:00</dnssec:remove>
	</dnssec:key>
      </dnssec:dnssec-signing>
      <statistics>
	<opcodes>
	  <opcode-count>
	    <opcode>query</opcode>
	    <count>1234</count>
	  </opcode-count>
	  <opcode-count>
	    <opcode>iquery</opcode>
	    <count>5678</count>
	  </opcode-count>
	  <opcode-count>
	    <opcode>status</opcode>
	    <count>9012</count>
	  </opcode-count>
	  <opcode-count>
	    <opcode>notify</opcode>
	    <count>3456</count>
	  </opcode-count>
	</opcodes>
	<packets>
	  <packet-count>
	    <packet-type>normal</packet-type>
	    <count>98765</count>
	  </packet-count>
	  <packet-count>
	    <packet-type>axfr</packet-type>
	    <count>43210</count>
	  </packet-count>
	  <packet-count>
	    <packet-type>ixfr</packet-type>
	    <count>12345</count>
	  </packet-count>
	  <packet-count>
	    <packet-type>notify</packet-type>
	    <count>67890</count>
	  </packet-count>
	  <packet-count>
	    <packet-type>update</packet-type>
	    <count>24680</count>
	  </packet-count>
	</packets>
      </statistics>
    </zone>
  </dns-server-state>
  <nacm xmlns="urn:ietf:params:xml:ns:yang:ietf-netconf-acm">
    <enable-nacm>true</enable-nacm>
    <read-default>permit</read-default>
    <write-default>deny</write-default>
    <exec-default>deny</exec-default>
    <denied-operations>123</denied-operations>
    <denied-data-writes>456</denied-data-writes>
    <denied-notifications>0</denied-notifications>
    <groups>
      <group>
        <name>admin</name>
	<user-name>root</user-name>
        <user-name>dominik</user-name>
      </group>
      <group>
	<name>users</name>
	<user-name>lada</user-name>
	<user-name>pavel</user-name>
      </group>
    </groups>
    <rule-list>
      <name>admin-acl</name>
      <group>admin</group>
      <rule>
        <name>permit-all</name>
	<module-name>*</module-name>
	<access-operations>*</access-operations>
        <comment>The 'admin' group has unlimited access.</comment>
	<action>permit</action>
      </rule>
    </rule-list>
    <rule-list>
      <name>users-acl</name>
      <group>users</group>
      <rule>
	<name>no-writes-on-example.com</name>
	<path>/dnss:dns-server/dnss:zones/dnss:zone[dnss:domain='example.com']</path>
	<access-operations>create update delete</access-operations>
	<comment>Users cannot write example.com.</comment>
	<action>deny</action>
      </rule>
      <rule>
	<name>permit-zone-access</name>
	<path>/dnss:dns-server/dnss:zones/dnss:zone</path>
	<access-operations>*</access-operations>
	<comment>Users can write other zones.</comment>
	<action>permit</action>
      </rule>
      <rule>
	<name>permit-zone-reload</name>
	<module-name>dns-server</module-name>
	<rpc-name>zone-reload</rpc-name>
	<comment>Users can reload zones</comment>
	<action>permit</action>
      </rule>
      <rule>
	<name>permit-zone-sign</name>
	<module-name>dnssec-signing</module-name>
	<rpc-name>zone-sign</rpc-name>
	<comment>Users can sign zones</comment>
	<action>permit</action>
      </rule>
    </rule-list>
  </nacm>
</nc:data>
